# ðŸ“Š Manual de OperaÃ§Ã£o - ESP32-S3 Leitor de Pulsos

## ðŸ“‹ Ãndice
1. [VisÃ£o Geral](#visÃ£o-geral)
2. [ConfiguraÃ§Ã£o Inicial](#configuraÃ§Ã£o-inicial)
3. [ConexÃµes de Hardware](#conexÃµes-de-hardware)
4. [ConfiguraÃ§Ãµes do Software](#configuraÃ§Ãµes-do-software)
5. [OperaÃ§Ã£o do Sistema](#operaÃ§Ã£o-do-sistema)
6. [InterpretaÃ§Ã£o dos Dados](#interpretaÃ§Ã£o-dos-dados)
7. [Funcionalidades AvanÃ§adas](#funcionalidades-avanÃ§adas)
8. [Troubleshooting](#troubleshooting)
9. [EspecificaÃ§Ãµes TÃ©cnicas](#especificaÃ§Ãµes-tÃ©cnicas)

---

## ðŸŽ¯ VisÃ£o Geral

O **ESP32-S3 Leitor de Pulsos** Ã© um sistema avanÃ§ado de mediÃ§Ã£o de pulsos digitais que oferece:

- âœ… **DetecÃ§Ã£o por interrupÃ§Ã£o de hardware** para mÃ¡xima precisÃ£o
- âœ… **Debounce adaptativo inteligente** que se ajusta automaticamente
- âœ… **MediÃ§Ã£o em tempo real** de frequÃªncia e perÃ­odos
- âœ… **Reset automÃ¡tico configurÃ¡vel** para anÃ¡lise periÃ³dica
- âœ… **Controle manual via botÃ£o** para reset instantÃ¢neo
- âœ… **Interface serial detalhada** com relatÃ³rios formatados

---

## âš™ï¸ ConfiguraÃ§Ã£o Inicial

### ðŸ“‹ Requisitos
- **Hardware**: ESP32-S3 ou ESP32 compatÃ­vel
- **Software**: Arduino IDE 2.0+ ou PlatformIO
- **Cabo**: USB para programaÃ§Ã£o e monitoramento
- **Monitor Serial**: 115200 baud

### ðŸ”§ InstalaÃ§Ã£o
1. **Copie o cÃ³digo** `LeituraPulsos.ino` para o Arduino IDE
2. **Selecione a placa** ESP32-S3 Dev Module
3. **Configure a velocidade** de upload conforme sua placa
4. **Compile e envie** o cÃ³digo para o ESP32-S3

---

## ðŸ”Œ ConexÃµes de Hardware

### ðŸ“ Pinout PadrÃ£o
```
ESP32-S3 Pinout:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ GPIO 2  â—â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€ Sinal de Pulso (Entrada)
â”‚ GPIO 0  â—â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€ BotÃ£o Reset (BOOT)
â”‚ GND     â—â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€ Terra de ReferÃªncia
â”‚ 3.3V    â—â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€ AlimentaÃ§Ã£o (se necessÃ¡rio)
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### ðŸ”— ConexÃµes Detalhadas

#### **Entrada de Pulsos (GPIO 2)**
- **Tipo**: Entrada digital com pull-up interno
- **TensÃ£o**: 0V (LOW) a 3.3V (HIGH)
- **DetecÃ§Ã£o**: Borda de descida (HIGH â†’ LOW)
- **ProteÃ§Ã£o**: Pull-up interno de ~45kÎ© ativado

#### **BotÃ£o de Reset (GPIO 0)**
- **Tipo**: Entrada digital (botÃ£o BOOT nativo)
- **FunÃ§Ã£o**: Reset manual do contador
- **OperaÃ§Ã£o**: Pressionar = LOW, Soltar = HIGH
- **Debounce**: 50ms implementado via software

#### **AlimentaÃ§Ã£o e Terra**
- **VCC**: 3.3V ou 5V (via USB)
- **GND**: Terra comum obrigatÃ³rio
- **Consumo**: ~80mA em operaÃ§Ã£o normal

### âš¡ Tipos de Sinais CompatÃ­veis

#### **Sinais Digitais 3.3V**
```
     3.3V â”Œâ”€â”    â”Œâ”€â”    â”Œâ”€â”
          â”‚ â”‚    â”‚ â”‚    â”‚ â”‚
      0V  â””â”€â”˜    â””â”€â”˜    â””â”€â”˜
          â†‘      â†‘      â†‘
       DetecÃ§Ã£o DetecÃ§Ã£o DetecÃ§Ã£o
```

#### **Sinais Digitais 5V**
âš ï¸ **ATENÃ‡ÃƒO**: Use divisor de tensÃ£o para sinais 5V
```
Sinal 5V â”€â”€â”¬â”€â”€ 2kÎ© â”€â”€â”¬â”€â”€ GPIO 2
           â”‚         â”‚
           â””â”€â”€ 1kÎ© â”€â”€â”´â”€â”€ GND
           
Resultado: 5V â†’ 1.67V (Seguro para ESP32)
```

#### **Sensores CompatÃ­veis**
- ðŸ”˜ **Sensores Hall** (efeito magnÃ©tico)
- ðŸ”˜ **Encoders Ã³pticos** (disco perfurado)
- ðŸ”˜ **Sensores indutivos** (proximidade metÃ¡lica)
- ðŸ”˜ **Chaves mecÃ¢nicas** (com debounce)
- ðŸ”˜ **Sensores de fluxo** (lÃ­quidos/gases)
- ðŸ”˜ **TacÃ´metros** (rotaÃ§Ã£o/RPM)

---

## ðŸŽ›ï¸ ConfiguraÃ§Ãµes do Software

### ðŸ“ ParÃ¢metros Principais

#### **Hardware**
```cpp
#define PULSE_PIN 2        // Pino de entrada dos pulsos
#define BUTTON_PIN 0       // Pino do botÃ£o de reset
```

#### **Debounce Adaptativo**
```cpp
#define DEBOUNCE_TIME_US_MIN 100      // MÃ­nimo: 100Î¼s (alta freq)
#define DEBOUNCE_TIME_US_MAX 5000     // MÃ¡ximo: 5000Î¼s (baixa freq)
#define DEBOUNCE_TIME_US_DEFAULT 1000 // Inicial: 1000Î¼s
```

#### **RelatÃ³rios e Reset**
```cpp
#define DISPLAY_INTERVAL 1000         // RelatÃ³rio a cada 1s
#define AUTO_RESET_INTERVAL 30000     // Reset automÃ¡tico: 30s
#define AUTO_RESET_ENABLED true       // Habilitar reset auto
```

### ðŸ”§ CustomizaÃ§Ãµes Comuns

#### **Para Alta FrequÃªncia (>10kHz)**
```cpp
#define DEBOUNCE_TIME_US_MIN 50       // Reduzir mÃ­nimo
#define DEBOUNCE_TIME_US_MAX 500      // Reduzir mÃ¡ximo
```

#### **Para Baixa FrequÃªncia (<1Hz)**
```cpp
#define DEBOUNCE_TIME_US_MIN 1000     // Aumentar mÃ­nimo
#define DEBOUNCE_TIME_US_MAX 10000    // Aumentar mÃ¡ximo
```

#### **Desabilitar Reset AutomÃ¡tico**
```cpp
#define AUTO_RESET_ENABLED false      // Apenas reset manual
```

---

## ðŸš€ OperaÃ§Ã£o do Sistema

### ðŸ“º Interface Serial

#### **Tela de InicializaÃ§Ã£o**
```
====================================================================
           ESP32-S3 LEITOR DE PULSOS - SISTEMA INICIADO           
====================================================================

CONFIGURAÃ‡Ã•ES:
â€¢ Pino de entrada: GPIO 2
â€¢ Pino do botÃ£o reset: GPIO 0
â€¢ Modo de detecÃ§Ã£o: Borda de descida (HIGH â†’ LOW)
â€¢ Debounce adaptativo: 100-5000 Î¼s
â€¢ Pull-up interno: ATIVADO
â€¢ Velocidade serial: 115200 bps
â€¢ Reset automÃ¡tico: HABILITADO (a cada 30 segundos)

âœ“ Hardware configurado com sucesso!
âœ“ InterrupÃ§Ã£o ativada no pino 2
âœ“ Sistema pronto para detectar pulsos!

INSTRUÃ‡Ã•ES:
1. Conecte o sinal de pulso ao pino GPIO 2
2. Use GND como referÃªncia comum
3. Pressione o botÃ£o GPIO 0 para reset manual
4. Observe as mediÃ§Ãµes em tempo real abaixo
```

#### **Tabela de MediÃ§Ãµes em Tempo Real**
```
====================================================================
| Timestamp | Pulsos | FrequÃªncia | PerÃ­odo |      Status         |
|    (ms)   | Total  |    (Hz)    |  (Î¼s)   |                     |
====================================================================
|     1234  |      1 |       0.00 |       0 | Pulso (D:1000Î¼s)   |
|     1654  |      2 |       2.38 |  420000 | Pulso (D:3360Î¼s)   |
|     2100  |      3 |       2.24 |  446000 | Pulso (D:3568Î¼s)   |
|----------|--------|------------|---------|---------------------|
| RELATÃ“RIO - Tempo: 3s                                           |
| Pulsos totais:      3 | Freq. mÃ©dia:    1 Hz                 |
|----------|--------|------------|---------|---------------------|
```

### ðŸ”„ OperaÃ§Ãµes BÃ¡sicas

#### **Iniciar MediÃ§Ã£o**
1. **Conecte o sinal** ao GPIO 2
2. **Abra o Monitor Serial** (115200 baud)
3. **Observe** os pulsos sendo detectados automaticamente

#### **Reset Manual**
1. **Pressione** o botÃ£o GPIO 0 (BOOT)
2. **Observe** a confirmaÃ§Ã£o no serial:
```
====================================================================
                      RESET MANUAL EXECUTADO                       
====================================================================
âœ“ Contador de pulsos zerado
âœ“ VariÃ¡veis de tempo reinicializadas
âœ“ Timer de reset automÃ¡tico reiniciado
âœ“ Sistema pronto para nova mediÃ§Ã£o
âœ“ Reset acionado via botÃ£o GPIO 0
====================================================================
```

#### **Reset AutomÃ¡tico (30s)**
```
====================================================================
                     RESET AUTOMÃTICO (30s)                        
====================================================================
ESTATÃSTICAS DO PERÃODO:
â€¢ Pulsos totais: 1500
â€¢ Tempo decorrido: 30.0 segundos
â€¢ FrequÃªncia mÃ©dia: 50.00 Hz
====================================================================
           NOVO PERÃODO INICIADO - CONTADOR ZERADO                 
====================================================================
```

---

## ðŸ“ˆ InterpretaÃ§Ã£o dos Dados

### ðŸ“Š Colunas da Tabela

#### **Timestamp (ms)**
- **DescriÃ§Ã£o**: Tempo decorrido desde o inÃ­cio
- **Formato**: Milissegundos
- **Uso**: Correlacionar eventos no tempo

#### **Pulsos (Total)**
- **DescriÃ§Ã£o**: Contador acumulativo
- **Formato**: NÃºmero inteiro
- **Reset**: Manual ou automÃ¡tico (30s)

#### **FrequÃªncia (Hz)**
- **DescriÃ§Ã£o**: FrequÃªncia instantÃ¢nea
- **CÃ¡lculo**: `1.000.000 / perÃ­odo_Î¼s`
- **PrecisÃ£o**: 2 casas decimais

#### **PerÃ­odo (Î¼s)**
- **DescriÃ§Ã£o**: Intervalo entre pulsos
- **Formato**: Microssegundos
- **Uso**: AnÃ¡lise de estabilidade

#### **Status**
- **`Pulso (D:XXXÎ¼s)`**: Debounce atual em uso
- **AdaptaÃ§Ã£o**: Valor muda conforme frequÃªncia

### ðŸ“‹ RelatÃ³rios PeriÃ³dicos

#### **RelatÃ³rio de 1 Segundo**
- **FrequÃªncia MÃ©dia**: Pulsos no Ãºltimo segundo
- **Tempo Decorrido**: Minutos e segundos
- **Pulsos Totais**: Contador acumulativo

#### **RelatÃ³rio de Reset (30s)**
- **EstatÃ­sticas Completas** do perÃ­odo
- **FrequÃªncia MÃ©dia** calculada
- **Tempo Exato** de mediÃ§Ã£o

---

## ðŸ§  Funcionalidades AvanÃ§adas

### ðŸŽ¯ Debounce Adaptativo

#### **Como Funciona**
1. **Coleta** histÃ³rico dos Ãºltimos 5 intervalos
2. **Calcula** mÃ©dia dos intervalos vÃ¡lidos
3. **Define** debounce como 8% da mÃ©dia
4. **Aplica** limites mÃ­nimo (100Î¼s) e mÃ¡ximo (5000Î¼s)
5. **Suaviza** mudanÃ§as com filtro ponderado

#### **Comportamento Adaptativo**
```
FrequÃªncia do Sinal    â†’ Debounce Aplicado
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
> 5 kHz (alta freq)    â†’ ~100Î¼s (mÃ­nimo)
1-5 kHz                â†’ 200-1000Î¼s
100Hz-1kHz             â†’ 1000-2000Î¼s
< 100Hz (baixa freq)   â†’ 2000-5000Î¼s
```

#### **Vantagens**
- âœ… **Auto-otimizaÃ§Ã£o** para qualquer sinal
- âœ… **Sem configuraÃ§Ã£o manual** necessÃ¡ria
- âœ… **MÃ¡xima sensibilidade** preservada
- âœ… **Filtro inteligente** de ruÃ­do

### ðŸ“Š AnÃ¡lise de Desempenho

#### **MÃ©tricas de Qualidade**
- **Estabilidade**: VariaÃ§Ã£o do perÃ­odo entre pulsos
- **PrecisÃ£o**: ResoluÃ§Ã£o de 1Î¼s para mediÃ§Ãµes
- **LatÃªncia**: < 10Î¼s para detecÃ§Ã£o de pulso
- **Throughput**: AtÃ© 100kHz recomendado

#### **Indicadores Visuais**
- **Debounce Decrescente**: FrequÃªncia aumentando
- **Debounce Crescente**: FrequÃªncia diminuindo
- **Debounce EstÃ¡vel**: Sinal regular

---

## ðŸ”§ Troubleshooting

### âŒ Problemas Comuns

#### **NÃ£o Detecta Pulsos**
**Sintomas**: Tabela vazia, sem atividade
**PossÃ­veis Causas**:
- ðŸ” ConexÃ£o incorreta no GPIO 2
- ðŸ” Terra (GND) nÃ£o conectado
- ðŸ” Sinal muito fraco (< 1.5V)
- ðŸ” Polaridade invertida

**SoluÃ§Ãµes**:
```
1. Verificar conexÃµes fÃ­sicas
2. Medir tensÃ£o do sinal com multÃ­metro
3. Confirmar terra comum
4. Testar com sinal conhecido (LED + resistor)
```

#### **Conta Pulsos Duplicados**
**Sintomas**: Contagem muito alta, frequÃªncia irreal
**PossÃ­veis Causas**:
- ðŸ” RuÃ­do elÃ©trico no sinal
- ðŸ” Bouncing em chaves mecÃ¢nicas
- ðŸ” InterferÃªncia eletromagnÃ©tica

**SoluÃ§Ãµes**:
```
1. Sistema adaptativo corrigirÃ¡ automaticamente
2. Adicionar capacitor de filtro (100nF)
3. Usar cabo blindado
4. Afastar de fontes de ruÃ­do
```

#### **Perde Pulsos RÃ¡pidos**
**Sintomas**: FrequÃªncia menor que esperada
**PossÃ­veis Causas**:
- ðŸ” Debounce muito alto para a frequÃªncia
- ðŸ” Pulsos muito estreitos (< 1Î¼s)
- ðŸ” Fonte do sinal instÃ¡vel

**SoluÃ§Ãµes**:
```
1. Sistema adaptativo ajustarÃ¡ automaticamente
2. Verificar especificaÃ§Ãµes do sensor
3. Melhorar fonte de alimentaÃ§Ã£o
4. Reduzir DEBOUNCE_TIME_US_MIN se necessÃ¡rio
```

#### **Reset NÃ£o Funciona**
**Sintomas**: BotÃ£o nÃ£o reseta contador
**PossÃ­veis Causas**:
- ðŸ” BotÃ£o BOOT defeituoso
- ðŸ” ConexÃ£o GPIO 0 problemÃ¡tica

**SoluÃ§Ãµes**:
```
1. Testar com botÃ£o externo no GPIO 0
2. Verificar continuidade do botÃ£o
3. Configurar outro pino em BUTTON_PIN
```

### âš ï¸ LimitaÃ§Ãµes Conhecidas

#### **FrequÃªncias Extremas**
- **MÃ¡xima**: ~100kHz (recomendado)
- **TeÃ³rica**: ~500kHz (com ajustes)
- **MÃ­nima**: 0.0002Hz (1 pulso por hora)

#### **PrecisÃ£o Temporal**
- **ResoluÃ§Ã£o**: 1Î¼s (microssegundo)
- **Deriva**: ~50ppm do cristal interno
- **Overflow**: ApÃ³s 49 dias contÃ­nuos

---

## ðŸ“ EspecificaÃ§Ãµes TÃ©cnicas

### ðŸ”Œ Hardware

| ParÃ¢metro | EspecificaÃ§Ã£o | ObservaÃ§Ãµes |
|-----------|---------------|-------------|
| **MCU** | ESP32-S3 | CompatÃ­vel ESP32 |
| **Clock** | 240MHz | Dual-core |
| **TensÃ£o** | 3.3V | Tolerante a 5V em alguns pinos |
| **Corrente** | 80mA tÃ­pico | Sem WiFi/Bluetooth |
| **ResoluÃ§Ã£o** | 1Î¼s | Timer de alta resoluÃ§Ã£o |
| **Entradas** | Pull-up 45kÎ© | ConfigurÃ¡vel |

### ðŸ“Š Performance

| MÃ©trica | Valor | CondiÃ§Ãµes |
|---------|-------|-----------|
| **Freq. MÃ¡xima** | 100kHz | Recomendado |
| **Freq. MÃ­nima** | 0.0002Hz | 1 pulso/hora |
| **LatÃªncia** | < 10Î¼s | DetecÃ§Ã£o por ISR |
| **PrecisÃ£o** | 1Î¼s | Timer interno |
| **Jitter** | < 5Î¼s | CondiÃ§Ãµes normais |
| **Estabilidade** | 50ppm | Cristal interno |

### ðŸ§® Algoritmos

#### **Debounce Adaptativo**
```
HistÃ³rico: Buffer circular de 5 amostras
CÃ¡lculo: mÃ©dia_intervalo / 12 (â‰ˆ8.3%)
Limites: 100Î¼s â‰¤ debounce â‰¤ 5000Î¼s
Filtro: (atualÃ—7 + novoÃ—3) / 10
```

#### **MediÃ§Ã£o de FrequÃªncia**
```
InstantÃ¢nea: 1.000.000 / perÃ­odo_Î¼s
MÃ©dia: pulsos_por_segundo
ResoluÃ§Ã£o: 0.01 Hz
```

---

## ðŸ“ž Suporte e Contato

### ðŸ†˜ Suporte TÃ©cnico
- **GitHub**: [RepositÃ³rio do Projeto]
- **DocumentaÃ§Ã£o**: Este arquivo `Operacao.MD`
- **CÃ³digo Fonte**: `LeituraPulsos.ino`

### ðŸ”„ AtualizaÃ§Ãµes
- **VersÃ£o Atual**: 1.0
- **Data**: 28/08/2025
- **Autor**: GitHub Copilot

### ðŸ“ LicenÃ§a
```
Este projeto Ã© fornecido "como estÃ¡" para fins educacionais e de desenvolvimento.
Uso por conta e risco do usuÃ¡rio.
```

---

## ðŸ“‹ Checklist de OperaÃ§Ã£o

### âœ… PrÃ©-OperaÃ§Ã£o
- [ ] ESP32-S3 conectado via USB
- [ ] Arduino IDE configurado corretamente
- [ ] CÃ³digo compilado sem erros
- [ ] Monitor Serial aberto (115200 baud)
- [ ] Sinal de entrada preparado
- [ ] ConexÃµes verificadas

### âœ… Durante OperaÃ§Ã£o
- [ ] Pulsos sendo detectados
- [ ] Debounce ajustando automaticamente
- [ ] FrequÃªncias coerentes com esperado
- [ ] RelatÃ³rios periÃ³dicos funcionando
- [ ] Reset manual operacional

### âœ… AnÃ¡lise de Dados
- [ ] Dados sendo coletados corretamente
- [ ] EstatÃ­sticas coerentes
- [ ] Estabilidade do sinal verificada
- [ ] Performance dentro do esperado

---

*Documento gerado automaticamente em 28/08/2025*
*VersÃ£o 1.0 - ESP32-S3 Leitor de Pulsos*
